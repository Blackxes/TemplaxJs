"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;"value"in descriptor&&(descriptor.writable=!0);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var Config=require("./Configuration.js"),ProcessClass=function(){function ProcessClass(id,template,userMarkup,options){var parentProcess=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck(this,ProcessClass);this.id=id||null;this.template=template||null;this.userMarkup=userMarkup||{};this.queryMarkup={};this.options=Object.assign({},Config.parsing.optionSets.templateProcess,options);this.currentQuery=null;this.parentProcess=parentProcess}_createClass(ProcessClass,[{key:"isSubProcess",get:function(){return Boolean(this.parentProcess)}}]);return ProcessClass}();exports.process=ProcessClass;var TemplateClass=function(){function TemplateClass(id,value,options){var parentTemplate=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,TemplateClass);this.id=id||null;this.value=value||null;this.options=options||{};this.parentTemplate=parentTemplate}_createClass(TemplateClass,[{key:"tid",get:function(){return this.id?this.id:this.parentTemplate.tid}},{key:"valid",get:function(){return Boolean(this.id||!this.id&&this.parentTemplate)}}]);return TemplateClass}();exports.template=TemplateClass;exports.rule=function RuleClass(id,rawRule,request,key,value,commandValue,options){_classCallCheck(this,RuleClass);this.id=id;this.rawRule=rawRule||null;this.request=request||null;this.key=key||null;this.value=value||null;this.commandValue=commandValue||null;this.options=options||null};var QueryClass=function(_exports$rule){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(QueryClass,exports.rule);function QueryClass(process,rule,template,isPostQuery){_classCallCheck(this,QueryClass);var _this2=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(QueryClass.__proto__||Object.getPrototypeOf(QueryClass)).call(this,rule.id,rule.rawRule,rule.request,rule.key,rule.value,rule.commandValue,rule.options));_this2.process=process;_this2.template=template||null;_this2.isPostQuery=isPostQuery||!1;return _this2}return QueryClass}();exports.query=QueryClass;exports.response=function ResponseClass(replacement,value,postQuery){var offset=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,ResponseClass);this.replacement=replacement||"";this.value=value||"";this.postQuery=postQuery||null;this.offset=void 0!==offset?offset:null;this.postQuery&&(this.postQuery.isPostQuery=!0)}},{"./Configuration.js":2}],2:[function(require,module,exports){exports.general={};exports.defaults={};exports.regex={};exports.regex.extractRule=function(){return new RegExp("{{([^<>]*?)}}","g")};exports.regex.extractRequest=function(){return new RegExp("([\\w-]+)(?:[\\w\\s:-]+)?","g")};exports.regex.extractKey=function(){return new RegExp("{{\\s*(?:[\\w-]+)\\s*:\\s*([\\w-]+)(?:[\\w\\s:-]+)?","g")};exports.regex.extractArea=function(query,id){return new RegExp(query.rawRule+"(.*?){{\\s*"+query.request+"\\s+end\\s*:\\s*"+id+"\\s*}}","g")};exports.debug={};exports.debug.display=!0;exports.debug.display_trace=!0;exports.parsing={};exports.parsing.optionSets={default:{render:!0,wrap:"|"},template:{processRuleCounter:!0,wrapContent:!0},templateInline:{renderInline:!1}};exports.defaults.templateOptionSet={render:!0}},{}],3:[function(require,module,exports){var ClassSet=require("./ClassSet.js"),ProcessManager=new(function(){function ProcessManagerClass(){_classCallCheck(this,ProcessManagerClass);this.processes=new Map;this.processIterator=0}_createClass(ProcessManagerClass,[{key:"create",value:function(template){var markup=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},parentProcess=arguments[3];if(!(template instanceof ClassSet.template))return!1;var process=new ClassSet.process(++this.processIterator,template,markup,options,parentProcess);this.processes.set(process.id,process);return this.get(process.id)}},{key:"delete",value:function(value){return!!value&&(value instanceof ClassSet.process?this.processes.delete(value.id):this.processes.delete(id))}},{key:"has",value:function(value){return value instanceof ClassSet.query?this.processes.has(value.processId):this.processes.has(value)}},{key:"get",value:function(value){return value instanceof ClassSet.query?this.processes.get(value.processId):this.processes.get(value)}},{key:"validate",value:function(value){var process=value&&value instanceof ClassSet.process?value:this.get(value);return!!(process&&process.id&&process.template&&process.template instanceof ClassSet.template)}}]);return ProcessManagerClass}());exports.processManager=ProcessManager},{"./ClassSet.js":1}],4:[function(require,module,exports){var Config=require("./Configuration.js"),ClassSet=require("./ClassSet.js"),Templax=require("./Templax.js"),RequestParser=new(function(){function RequestParserClass(){_classCallCheck(this,RequestParserClass);this.pManager=require("./ProcessManager.js").processManager;this.tManager=require("./TemplateManager.js").templateManager;this.requestIterator=0}_createClass(RequestParserClass,[{key:"parse",value:function(query){this.requestIterator++;return"false"===String(query.options.render)?new ClassSet.response(query.rawRule,null,!1):query.request in this?this[query.request](query):new ClassSet.response(query.rawRule,query.value,!1)}},{key:"template",value:function(query){if(!query.key)return null;if(!this.tManager.has(query.key))return new ClassSet.response(query.rawRule,query.isPostQuery?"":query.rawRule,!query.isPostQuery&&query,0);var response=new ClassSet.response(query.rawRule,null,!1),content=Templax.app.parse(query.key,query.value,!1,this.pManager.get(query));response.value=content;return response}},{key:"templateInline",value:function(query){if(!query.key)return null;var response=new ClassSet.response(query.rawRule,"",!1),templateMatch=Config.regex.extractArea(query,query.key).exec(query.template);if(!templateMatch)return response;if(!this.tManager.register(query.key,templateMatch[1]))return response;response.replacement=templateMatch[0];query.options.renderInline&&(response.value=Templax.app.parse(query.key,query.value));return response}},{key:"foreach",value:function(query){if(!query.key||!query.value||query.value&&query.value.constructor!==Array)return null;var response=new ClassSet.response(query.rawRule,"",!1),foreachMatch=Config.regex.extractArea(query,query.key).exec(query.template);if(!foreachMatch)return response;response.replacement=foreachMatch[0];var content="";query.value.forEach(function(currentMarkup){content+=Templax.app.parse(new ClassSet.template(null,foreachMatch[1],query.rawRule.options,query.process.template),currentMarkup,!1,query.process)});response.value=content;return response}},{key:"case",value:function(query){if(!query.key)return null;var response=new ClassSet.response(query.rawRule,"",!1),caseMatch=Config.regex.extractArea(query,query.key).exec(query.template);if(!caseMatch)return response;response.replacement=caseMatch[0];if(!query.value)return response;response.value=Templax.app.parse(new ClassSet.template(null,caseMatch[1],query.options,query.process.template),query.value,!1,query.process);return response}},{key:"if",value:function(query){if(!query.key)return null;var response=new ClassSet.response(query.rawRule,""),ifMatch=Config.regex.extractArea(query,query.key).exec(query.template);if(!ifMatch)return response;response.replacement=ifMatch[0];if(!query.process.queryMarkup[query.key])return response;response.value=Templax.app.parse(new ClassSet.template(null,ifMatch[1],query.options,query.process.template),query.commandValue||{},!1,query.process);return response}},{key:"debug",value:function(query){var response=new ClassSet.response(query.rawRule,"no data found",!1);response.value="Currently not implemented!";return response}}]);return RequestParserClass}());exports.requestParser=RequestParser},{"./ClassSet.js":1,"./Configuration.js":2,"./ProcessManager.js":3,"./TemplateManager.js":6,"./Templax.js":7}],5:[function(require,module,exports){var Config=require("./Configuration.js"),ClassSet=require("./ClassSet.js"),RuleParser=new(function(){function RuleParser(){_classCallCheck(this,RuleParser);this.ruleIterator=0}_createClass(RuleParser,[{key:"parse",value:function(process,rawRule){var rule=new ClassSet.rule(++this.ruleIterator,rawRule);rule.request=this._extractRulePiece(rawRule,Config.regex.extractRequest())[1]||null;rule.key=this._extractRulePiece(rawRule,Config.regex.extractKey())[1]||null;var primeKey=rule.key||rule.request,queryMarkup=process.queryMarkup,requestValue=queryMarkup[primeKey],customOptions={};if(requestValue&&requestValue.constructor===Object){requestValue._options&&requestValue._options.constructor===Object&&(customOptions=requestValue._options);!requestValue.value||requestValue.value.constructor===Object&&requestValue.value.constructor===Array||(requestValue=requestValue.value)}rule.value=requestValue;rule.commandValue=queryMarkup[rule.request+"-"+rule.key];rule.options=this._resolveObjectFunctions(Object.assign({},Config.parsing.optionSets.default,Config.parsing.optionSets[rule.request]||{},customOptions));return rule}},{key:"_extractRulePiece",value:function(rawRule,regex){if(!rawRule||!regex||rawRule.constructor!==String||regex.constructor!==RegExp)return[];var match=regex.exec(rawRule),results=[];if(!match)return results;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=match[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;results.push(item)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return results}},{key:"_resolveObjectFunctions",value:function(values){if(!values||values&&values.constructor===Array)return null;values.constructor!==Object&&(values={__value:values});for(var index in values){var item=values[index];item&&item.constructor===Function&&(values[index]=item())}return values.__value||values}}]);return RuleParser}());exports.ruleParser=RuleParser},{"./ClassSet.js":1,"./Configuration.js":2}],6:[function(require,module,exports){var ClassSet=require("./ClassSet.js"),TemplateManager=new(function(){function TemplateManagerClass(){_classCallCheck(this,TemplateManagerClass);this.templates=new Map;this._loadFromDOM()}_createClass(TemplateManagerClass,[{key:"_loadFromDOM",value:function(){var raw=document.querySelector("template#tx-templates");if(raw){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=raw.content.children[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var elm=_step2.value;this.register(elm.id,elm.innerHTML)||console.log("HTParser: registering template %s failed",elm.id)}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}return!0}},{key:"register",value:function(id,template){if(!id||id&&id.constructor!==String||!template||template.constructor!==String)return console.log("HTParser: invalid values for template registration: %s",id);if(this.templates.has(id))return console.log("HTParser: duplicated template found: '%s'",id);var result=this.templates.set(id,new ClassSet.template(id,template.replace(/\s{2,}/g,"")));return!!result&&result.size}},{key:"get",value:function(id){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]?this.templates.values():this.templates.get(id)}},{key:"has",value:function(id){return this.templates.has(id)}},{key:"setOptions",value:function(id,definition,value){if(!this.hasTemplate(id))return!1;if(definition||value)if(definition.constructor===Object)this.getTemplate(id).options=definition;else{if(definition.constructor!==String)return!1;this.getTemplate(id).options[definition]=value}else this.getTemplate(id).options={};return!0}},{key:"setMarkup",value:function(id,definition,value){if(!this.templates.has(id))return!1;if(definition||value)if(definition.constructor===Object)this.getTemplate(id).markup=definition;else{if(definition.constructor!==String)return!1;this.getTemplate(id).markup[definition]=value}else this.getTemplate(id).markup={};return!0}}]);return TemplateManagerClass}());exports.templateManager=TemplateManager},{"./ClassSet.js":1}],7:[function(require,module,exports){var Config=require("./Configuration.js"),ClassSet=require("./ClassSet.js"),Templax=new(function(){function TemplaxClass(){_classCallCheck(this,TemplaxClass);this.tManager=require("./TemplateManager.js").templateManager;this.pManager=require("./ProcessManager.js").processManager;this.rqParser=require("./RequestParser.js").requestParser;this.rlParser=require("./RuleParser.js").ruleParser}_createClass(TemplaxClass,[{key:"define",value:function(configs){if(!configs||configs.constructor!==Object)return!1;for(var _id in configs){var item=configs[_id];item.markup&&tManager.setMarkup(_id,item.markup);item.options&&tManager.setOptions(_id,item.options)}return!0}},{key:"parse",value:function(id,markup,options){var parentProcess=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,pSet=this._verifyParsingSet(id,markup,options);return pSet.options.render&&pSet.template.valid?this._processTemplate(pSet.template,pSet.markup,pSet.options,function(query){return this.rqParser.parse(query)},null,parentProcess):""}},{key:"_verifyParsingSet",value:function(templateValue,markup,options){return{template:this.tManager.has(templateValue)?this.tManager.get(templateValue):templateValue&&templateValue instanceof ClassSet.template?templateValue:templateValue&&templateValue.constructor===String?new ClassSet.template(null,templateValue):new ClassSet.template(null,null),markup:markup&&markup.constructor==Object?markup:{},options:options&&options.constructor==Object?Object.assign(Config.defaults.templateOptionSet,options):Config.defaults.templateOptionSet}}},{key:"_processTemplate",value:function(template){var markup=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},_callback=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,_this=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,parentProcess=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,process=this.pManager.create(template,markup,options,parentProcess);process.options=Object.assign({},process.options,options);var regExtractRule=Config.regex.extractRule(),callback=_callback&&_callback.constructor==Function?_callback.bind(_this||this):function(){return null};process.queryMarkup=Object.assign({},this._buildBaseMarkup(process),template.markup,markup);for(var rawRule=null,content=template.value,lastIterator=regExtractRule.lastIndex,postQueries=[];rawRule=regExtractRule.exec(content);){var rule=this.rlParser.parse(process,rawRule[0]),query=new ClassSet.query(process,rule,content.substring(lastIterator),!1);process.currentQuery=query;var response=this._reviewProcessResponse(process,callback(query));response.postQuery&&postQueries.push(response.postQuery);regExtractRule.lastIndex+=null!==response.offset?Number(response.offset):-(query.rawRule.length-response.value.length);lastIterator=regExtractRule.lastIndex;content=content.replace(response.replacement,response.value)}postQueries.forEach(function(postQuery){var response=callback(postQuery);content=content.replace(response.replacement,response.value)});this.pManager.delete(process);return content}},{key:"_buildBaseMarkup",value:function(process){return this.pManager.validate(process)?{"tx-template-id":process.template.id||process.isSubProcess?process.template.id:process.template.tid+"-subtemplate"}:{}}},{key:"_reviewProcessResponse",value:function(process,response){if(!(response&&response instanceof ClassSet.response))return new ClassSet.response(process.currentQuery.rule,"",!1);response.replacement&&response.replacement.constructor===String||(response.replacement=process.currentQuery.rawRule);(!response.value||response.value.constructor!==String&&response.value.constructor!==Function)&&(response.value=String(response.value));return response}},{key:"templates",get:function(){return this.tManager.get(null,!0)}}]);return TemplaxClass}());exports.app=Templax},{"./ClassSet.js":1,"./Configuration.js":2,"./ProcessManager.js":3,"./RequestParser.js":4,"./RuleParser.js":5,"./TemplateManager.js":6}],8:[function(require,module,exports){var Templax=require("./Templax.js").parser;window&&(window.templax=Templax);exports.templax=Templax},{"./Templax.js":7}]},{},[8]);